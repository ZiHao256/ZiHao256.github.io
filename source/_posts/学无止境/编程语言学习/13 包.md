---
title: 13 包
categories: 
  - 学无止境
  - 编程语言学习
tags:
  - The Go Programming Language
abbrlink: 9d9aaa60
typora-copy-images-to:
date: 2021-05-06 15:36:06
---



# 13 包


* 在工程化Go 开发项目中，Go 的源码复用建立在 包 基础之上
* 定义包、导出包内容、导入其他包

## 包介绍

* `package` 是多个Go 源码的集合，高级的代码复用方案
* 内置包：`fmt`, `os`,`io`



## 定义包

* **一个包** 简单理解为存放`.go`文件的**文件夹**
  * 该文件夹下的所有`go`文件，都要在代码第一行添加`package 包名`,声明该文件归属的包
* ==注意：==
  * 一个文件夹下，直接包含的文件只能归属于一个`package`, 同样一个`package`文件不能在多个文件夹下
  * 包名不可以和文件夹名一样
  * 包名为`main`的包，是程序的入口包，这种包编译后会得到一个可执行文件，而编译不包含`main`包的源代码则不会得到可执行文件



## 可见性

* 如果想在一个包中，引用另一个包里的 **标识符**，该标识符必须对外可见（`public`）,
* Go 中只需要将标识符的首字母大写，即为`public`

* ```go
  package pkg2
  
  import "fmt"
  
  // 包变量可见性
  
  var a = 100 // 首字母小写，外部包不可见，只能在当前包内使用
  
  // 首字母大写外部包可见，可在其他包中使用
  const Mode = 1
  
  type person struct { // 首字母小写，外部包不可见，只能在当前包内使用
  	name string
  }
  
  // 首字母大写，外部包可见，可在其他包中使用
  func Add(x, y int) int {
  	return x + y
  }
  
  func age() { // 首字母小写，外部包不可见，只能在当前包内使用
  	var Age = 18 // 函数局部变量，外部包不可见，只能在当前函数内使用
  	fmt.Println(Age)
  }
  ```

* 结构体的 **字段名和接口中的方法名** 如果**首字母都是大写**，外部包可以访问这些字段和方法

  * ```go
    type Student struct {
    	Name  string //可在包外访问的方法
    	class string //仅限包内访问的字段
    }
    
    type Payer interface {
    	init() //仅限包内访问的方法
    	Pay()  //可在包外访问的方法
    }
    ```



## 包的导入

* 使用`import`关键字 导入包
  * `import "包的路径"`
* 注意：
  * import 导入语句通常放在文件开头包声明语句下面
  * 导入的包名需要使用双引号包裹
  * 包名是从`$GOPATH/src/` 后开始的
  * 禁止循环导入包



### 单行导入

* `import ""`
* `import ""`



### 多行导入

```go
import (
	""
	""
)
```

## 自定义包名

* 导入包名时，可以为导入的包设置别名
  * `import 别名 "包的路径"`



## 匿名导入包

* 如果只希望导入包，不使用内部数据，可以使用匿名导入：
  * `import _ "包的路径"`
* 一样会被编译到可执行文件中



## init() 初始化函数



### init() 函数介绍

* Go 语言程序执行时，导入包语句 会自动触发包内部`init()` 函数的调用
* `init()` 函数没有参数和返回值
* `init()`函数在程序运行时，**会被自动调用执行**，**不能在代码中主动调用**

* 包中 `init()` 函数的执行时机
  * ![包中的init()执行时机](E:\LearningNotes\Go\包.assets\init01.png)

### init() 函数执行顺序

* Go 会从`main` 包开始检查其导入的所有包，每个包有可能导入了其他包
* Go 编译器由此构建出一个树状的包引用关系，再根据引用顺序决定编译顺序，依次编译这些包的代码
* 在运行时，最后被导入的包 最先被初始化并调用其`init()` 函数
  * ![包之间的init()执行顺序](E:\LearningNotes\Go\包.assets\init02.png)

## 练习题

* 编写一个`calc`包实现加减乘除四个功能函数，在`snow`这个包中导入并使用加减乘除四个函数实现数学运算